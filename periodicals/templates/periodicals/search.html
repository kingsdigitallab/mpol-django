{% extends 'base.html' %}
{% load highlight %}

{% block meta_title %}Search{% endblock %}
{% block title %}Search {% endblock %}

{% block main %}

<section class="section">
    <div class="container">
        <form method="get" action=".">
            <table>
                {{ form.as_table }}
                <tr>
                    <td>&nbsp;</td>
                    <td>
                        <input type="submit" value="Search">
                    </td>
                </tr>
            </table>
        </form>
    </div>
</section>

<section class="section">
    <div class="container">
        <h3 class="subtitle">Filters</h3>

        <div class="columns is-multiline">

            {% for key, values in facets.fields.items %}
            <div class="column is-one-third">
                <h4>By {{ key|capfirst }}</h4>
                <ul>
                    {% for item in values %}
                    <li>
                        <a href="?{{ form.data.urlencode }}&amp;selected_facets={{ key }}:{{ item.0|urlencode }}">{{ item.0 }}</a>
                        ({{ item.1 }})
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<section class="section">
    <div class="container">

        <h3 class="title">Results</h3>

        <div class="columns">
            <div class="column"><strong>Publication</strong></div>
            <div class="column"><strong>Issue</strong></div>
            <div class="column"><strong>Category</strong></div>
            <div class="column"><strong>Page</strong></div>
            <div class="column"><strong>Article Title</strong></div>

        </div>
        {% for result in page_obj.object_list %}
        <div class="columns">
            <div class="column">
                <a href="{{ result.publication_url }}">{{ result.publication_abbreviation }}</a>
            </div>
            <div class="column">
                <a href="{{ result.issue_url }}">{{ result.issue_date }}</a>
            </div>
            <div class="column">
                {{ result.category }}
            </div>
            <div class="column">
                <a href="{{ result.page_url }}?highlight={{ query }}">
                    p. {{ result.page_number }}
                </a>
            </div>
            <div class="column">
                <a href="{{ result.url }}?highlight={{ query }}">
                    {% if result.title %}
                    {{ result.title }}
                    {% else %}
                    {{ result.aid }}
                    {% endif %}
                </a>
                {% if query %}
                <p>
                    {% highlight result.text with query html_tag "strong" %}
                </p>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p>No results found.</p>
        {% endfor %}

        {% if page_obj.has_previous or page_obj.has_next %}
        <div>
            {% if page_obj.has_previous %}<a href="?{{ form.data.urlencode }}&amp;page={{ page_obj.previous_page_number }}">{% endif %}&laquo; Previous{% if page_obj.has_previous %}</a>{% endif %}
            |
            {% if page_obj.has_next %}<a href="?{{ form.data.urlencode }}&amp;page={{ page_obj.next_page_number }}">{% endif %}Next &raquo;{% if page_obj.has_next %}</a>{% endif %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}