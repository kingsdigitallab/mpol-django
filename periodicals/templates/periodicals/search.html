{% extends 'periodicals/base.html' %}
{% load highlight periodicals_tags %}

{% block meta_title %}Search{% endblock %}
{% block title %}Search {% endblock %}

{% block breadcrumbs %}
<li><a href="/">Home</a></li>
<li>Search</li>
{% endblock %}

{% block main %}
<section class="search">
    <form method="get" action=".">
        <div class="row medium-up-3 large-up-3">
            <div class="column column-block">
                {% with field=form.q %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                <p class="help">{{ field.help_text|safe }}</p>
                {% endif %} {% endwith %} {% with field=form.mode %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                <p class="help">{{ field.help_text|safe }}</p>
                {% endif %} {% endwith %}
            </div>
            <div class="column column-block">
                <div class="grid-x  grid-padding-y medium-up-full large-up-2">
                    <div class="cell">
                        {% with field=form.start_year %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                        <p class="help">{{ field.help_text|safe }}</p>
                        {% endif %} {% endwith %}
                    </div>
                    <div class="cell">
                        {% with field=form.end_year %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                        <p class="help">{{ field.help_text|safe }}</p>
                        {% endif %} {% endwith %}
                    </div>
                </div>
            </div>
            <div class="column column-block">
                {% with field=form.order_by %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                <p class="help">{{ field.help_text|safe }}</p>
                {% endif %} {% endwith %}
                <input class="button" type="submit" value="Search">
            </div>
        </div>
    </form>
</section>

<!-- <section class="grid-container"> -->
<section>
    <div class="row">
        <div class="small-12 columns">
            <h1 class="underline">
                Results
            </h1>

            <p>Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ paginator.count }} matches</p>
        </div>

        <div class="small-12 columns">
            <ul class="accordion" data-accordion data-multi-expand="true" data-allow-all-closed="true">
                <li class="accordion-item is-active" data-accordion-item>
                    <a href="#" class="accordion-title">Filters</a>
                    
                    <div class="accordion-content" data-tab-content>
                        <div class="row">
                            {% for key, values in facets.fields.items %}
                            <div class="small-12 columns">
                                <h2>{{ key|capfirst }}</h2>
                                <ul>
                                    {% for item in values %}
                                    <li>
                                        <a href="?{{ form.data.urlencode }}&amp;selected_facets={{ key }}:{{ item.0|urlencode }}">{{ item.0 }} <span>({{ item.1 }})</span></a>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</section>

<div class="row">
    <div class="small-12 columns">
        <div class="tab_container">
            <input id="tab2" type="radio" name="tabs">
            <label for="tab2" class="float-right">
                <i class="fa fa-th"></i>
                Grid
            </label>   
            <input id="tab1" type="radio" name="tabs" checked>
            <label for="tab1" class="float-right">
                <i class="fa fa-list-ul"></i>
                List
            </label>

            <section id="content1" class="tab-content">
                <table class="stack unstriped">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Page</th>
                            <th>Title</th>
                            <th>
                                <!-- *** Not sure how to add heading here *** -->
                                {% if result.title %}Extract{% endif %}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in page_obj.object_list %}
                        <tr>
                            <td>
                                {{ result.category }}
                            </td>

                            <td>
                                {{ result.publication_abbreviation }}, {{result.issue_date }}, page {{ result.page_number }}
                            </td>

                            <td>
                                <a href="{{ result.url }}?highlight={{ query }}">
                                    {% if result.title %}
                                    {{ result.title }}
                                    {% else %}
                                    {{ result.aid }}
                                    {% endif %}
                                </a>
                            </td>
                            
                            {% if query %}
                            <td class="paragraph">
                                {% highlight result.text with query html_tag "strong" %}
                            </td>
                            {% endif %}
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4">No results found.</p>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </section>

                <section id="content2" class="tab-content">
                    <div class="row small-up-2 large-up-4" data-equalizer="cards" data-equalize-by-row="true" data-equalize-on="medium">
                        {% for result in page_obj.object_list %}
                        <div class="column">
                            <div class="card search-results" data-equalizer-watch="cards">
                                <div class="card-section">
                                    <h2><a href="{{ result.publication_url }}">{{ result.publication_abbreviation }}</a></h2>
                                    <a href="{{ result.issue_url }}">{{ result.issue_date }}</a>
                                    <p>
                                        <a href="{{ result.url }}?highlight={{ query }}">
                                            {% if result.title %}
                                            {{ result.title }}
                                            {% else %}
                                            {{ result.aid }}
                                            {% endif %}
                                        </a>
                                    </p>
                                    {% if query %}
                                    <div class="row card-highlight">
                                        <div class="small-12 columns">
                                            {% highlight result.text with query html_tag "strong" %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    <div class="card-footer">
                                        {{ result.category }},
                                        <a href="{{ result.page_url }}?highlight={{ query }}">
                                            p. {{ result.page_number }}
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="column">
                            <p>No results found.</p>
                        </div>
                        {% endfor %}
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- <div class="grid-container"> -->
    {% if page_obj.has_previous or page_obj.has_next %} {% get_request_parameters exclude="page" as params %}
    <div class="row">
        <div class="small-12 columns">
            <ul class="pagination text-center" role="navigation" aria-label="Pagination">
                <li class="{% if page_obj.has_previous %}pagination-previous{% else %}pagination-previous disabled{% endif %}">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}{% if params %}{{ params }}{% endif %}" aria-label="Previous page">
                        {% endif %}
                        Prev <span class="show-for-sr">page</span>
                        {% if page_obj.has_previous %}
                    </a>
                    {% endif %}
                </li>
                <li>
                    Page {{ page_obj.number }} of {{ paginator.num_pages }}
                </li>
                <li class="{% if page_obj.has_next %}pagination-next{% else %}pagination-next disabled{% endif %}">
                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if params %}{{ params }}{% endif %}" aria-label="Next page">
                        {% endif %}
                        Next <span class="show-for-sr">page</span>
                        {% if page_obj.has_next %}
                    </a>
                    {% endif %}
                </li>
            </ul>
        </div>
    </div>
    {% endif %}
    <!-- </div> -->
    {% endblock %}