{% extends 'periodicals/base.html' %} {% load highlight periodicals_tags %} {% block meta_title %}Search{% endblock %} {% block title %}Search {% endblock %} {% block breadcrumbs %}
<li><a href="/">Home</a></li>
<li>Search</li>
{% endblock %} {% block main %}
<section class="search">
    <form method="get" action=".">
        <div class="grid-container">
            <div class="grid-x  grid-padding-y medium-up-3 large-up-3">
                <div class="cell">
                    {% with field=form.q %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                    <p class="help">{{ field.help_text|safe }}</p>
                    {% endif %} {% endwith %} {% with field=form.mode %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                    <p class="help">{{ field.help_text|safe }}</p>
                    {% endif %} {% endwith %}
                </div>
                <div class="cell">
                    <div class="grid-x  grid-padding-y medium-up-full large-up-2">
                        <div class="cell">
                            {% with field=form.start_year %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                            <p class="help">{{ field.help_text|safe }}</p>
                            {% endif %} {% endwith %}
                        </div>
                        <div class="cell">
                            {% with field=form.end_year %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                            <p class="help">{{ field.help_text|safe }}</p>
                            {% endif %} {% endwith %}
                        </div>
                    </div>
                </div>
                <div class="cell">
                    {% with field=form.order_by %} {{ field.errors }} {{ field.label_tag }} {{ field }} {% if field.help_text %}
                    <p class="help">{{ field.help_text|safe }}</p>
                    {% endif %} {% endwith %}
                    <input class="button" type="submit" value="Search">
                </div>
            </div>
        </div>
    </form>
</section>
<section class="grid-container">
    <div class="grid-x">
        <div class="cell">
            <h1 class="underline">
            Results
        </h1>
            <br>
            <p>Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ paginator.count }} matches</p>
        </div>
        <div class="cell">
            <ul class="accordion" data-accordion data-multi-expand="true" data-allow-all-closed="true">
                <li class="accordion-item is-active" data-accordion-item>
                    <a href="#" class="accordion-title">Filters</a>
                    <div class="accordion-content" data-tab-content>
                        <div class="grid-x">
                            {% for key, values in facets.fields.items %}
                            <div class="cell">
                                <h2>{{ key|capfirst }}</h2>
                                <ul>
                                    {% for item in values %}
                                    <li>
                                        <a href="?{{ form.data.urlencode }}&amp;selected_facets={{ key }}:{{ item.0|urlencode }}">{{ item.0 }} <span>({{ item.1 }})</span></a>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="grid-x">
        <div class="cell tabs" data-tabs id="issue-tabs">
            <ul class="menu align-right">
                <li class="tabs-title is-active"><a href="#list" aria-selected="true"><i class="fa fa-list-ul" aria-hidden="true"></i> List</a></li>
                <li class="tabs-title"><a data-tabs-target="grid" href="#grid"><i class="fa fa-th" aria-hidden="true"></i> Grid</a></li>
            </ul>
        </div>
    </div>
</section>
<div class="grid-container tabs-content" data-tabs-content="issue-tabs">
    <section class="tabs-panel is-active" id="list">
        <div class="grid-x">
            <div class="cell">
                <table class="stack unstriped">
                    <thead>
                        <tr>
                            <th>
                                Category
                            </th>
                            <th>
                                Page
                            </th>
                            <th>
                                Title
                            </th>
                            
                            <th>
                                <!-- *** Not sure how to add heading here *** -->
                                {% if result.title %} Extract {% else %} {% endif %}
                            </th>
                        </tr>
                    </thead>
                    {% for result in page_obj.object_list %}
                    <tbody>
                        <tr>
                            <td>
                                {{ result.category }}
                            </td>

                            <td>
                                {{ result.publication_abbreviation }}, {{result.issue_date }}, page {{ result.page_number }}
                            </td>

                             <td> <a href="{{ result.url }}?highlight={{ query }}">
                                {% if result.title %}
                                {{ result.title }}
                                {% else %}
                                {{ result.aid }}
                                {% endif %}
                            </a></td>
                           
                            {% if query %}
                            <td class="paragraph">
                                {% highlight result.text with query html_tag "strong" %}
                            </td>
                            {% endif %} {% empty %}
                            <div class="cell">
                                <p>No results found.</p>
                            </div>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>
        </div>
    </section>
    <section class="tabs-panel" id="grid">
        <!-- *** Card *** -->
        <div class="grid-container data-equalizer">
            <div class="grid-x grid-padding-x small-up-2 large-up-4">
                {% for result in page_obj.object_list %}
                <div class="cell">
                    <div class="card search-results data-equalizer-watch">
                        <div class="card-section">
                            <h2><a href="{{ result.publication_url }}">{{ result.publication_abbreviation }}</a></h2>
                            <a href="{{ result.issue_url }}">{{ result.issue_date }}</a>
                            <p>
                                <a href="{{ result.url }}?highlight={{ query }}">
                                {% if result.title %}
                                {{ result.title }}
                                {% else %}
                                {{ result.aid }}
                                {% endif %}
                            </a>
                            </p>
                            {% if query %}
                            <div class="card-highlight">
                                <div class="cell">
                                    {% highlight result.text with query html_tag "strong" %}
                                </div>
                            </div>
                            {% endif %}
                            <div class="card-footer">
                                {{ result.category }},
                                <a href="{{ result.page_url }}?highlight={{ query }}">
                                p. {{ result.page_number }}
                            </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="cell">
                    <p>No results found.</p>
                </div>
                {% endfor %}
            </div>
        </div>
        <!-- *** Card End *** -->
    </section>
</div>
<div class="grid-container">
    {% if page_obj.has_previous or page_obj.has_next %} {% get_request_parameters exclude="page" as params %}
    <div class="grid-x">
        <div class="cell">
            <ul class="pagination text-center" role="navigation" aria-label="Pagination">
                <li class="{% if page_obj.has_previous %}pagination-previous{% else %}pagination-previous disabled{% endif %}">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}{% if params %}{{ params }}{% endif %}" aria-label="Previous page">
                        {% endif %}
                            Prev <span class="show-for-sr">page</span>
                        {% if page_obj.has_previous %}
                        </a> {% endif %}
                </li>
                <li>Page {{ page_obj.number }} of {{ paginator.num_pages }} </li>
                <li class="{% if page_obj.has_next %}pagination-next{% else %}pagination-next disabled{% endif %}">
                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if params %}{{ params }}{% endif %}" aria-label="Next page">
                        {% endif %}
                            Next <span class="show-for-sr">page</span>
                        {% if page_obj.has_next %}
                        </a> {% endif %}
                </li>
            </ul>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}