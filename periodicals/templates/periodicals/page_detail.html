{% extends 'periodicals/base.html' %}
{% load periodicals_tags %}

{% block title %}
    {{ page.publication }} {{ page.issue }}, Page {{ page.number }}
{% endblock %}

{% block meta_title %}
    {{ page.publication }} {{ page.issue }}, Page {{ page.number }}
{% endblock %}

{% block main %}

<section class="row">
    <div class="small-12 columns">
        <ul class="menu">
            {% get_request_parameters as search_params %}
            {% if search_params %}
            <li>
                <a href="{% url 'search' %}?{{ search_params }}"><i class="fa fa-arrow-left" aria-hidden="true"></i> Back to results</a>
            </li>
            {% endif %}
            <li>
                <a href="{{ page.issue.url }}"><i class="fa fa-arrow-left" aria-hidden="true"></i> Issue</a>
            </li>
        </ul>
    </div>
</section>

<section class="row large-up-2">
    <div class="column column-block" data-equalizer-watch="cards">
        <div class="tabs">
            <ul class="menu subnav">
                <li class="tabs-title is-active">
                    <a href="#image" aria-selected="true">Image</a>
                </li>
            </ul>
        </div>
        <div class="tabs-content">
            <ul class="menu">
                <li>
                    <a href="{{ page.print_url }}" target="_blank"><i class="fa fa-print" aria-hidden="true"></i> Print image</a>
                </li>
            </ul>
            <section class="tabs-panel is-active">
                <div class="row">
                    <div class="small-12 columns">
                        <canvas class="pageCanvas border" data-image-id="page{{ page.number}}" width="{{ page.width }}" height="{{ page.height }}">
                            {% comment %} Fallback for non-canvas supporting devices {% endcomment %}
                            <img id="page{{ page.number}}" src="{{ page.image.url }}">
                        </canvas>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <div class="column column-block" data-equalizer-watch="cards">
        <div class="tabs" data-tabs id="page-tabs">
            <ul class="menu subnav">
                <li class="tabs-title is-active"><a data-tabs-target="contents" href="#contents">Contents</a></li>
                <li class="tabs-title"><a data-tabs-target="transcription" href="#transcription">Transcription</a></li>
                <li class="tabs-title"><a data-tabs-target="citation" href="#citation">Citation</a></li>
            </ul>
        </div>
        <div class="tabs-content" data-tabs-content="page-tabs">
            <section class="tabs-panel" id="transcription">
                <div class="note"> Note: This is an Optical Character Recognition (OCR) programs “read” these images and convert them to text documents which can be easily searched, copied, edited, or used for computational text analysis methods.
                </div>

                {% for article in page.articles_in_page.all %}
                <div id="{{ article.aid }}">
                    <h3 class="subtitle">{{ article|title }}</h3>
                    {{ article.content_html|safe }}
                </div>
                {% endfor %}
            </section>
            <section class="tabs-panel" id="citation">
                “{{ page.issue }}, Page {{ page.number }}” <i>Masonic Periodicals Online</i>, Library and Museum Charitable Trust of the United Grand Lodge of England, {% now "j N Y" %}, {{ request.META.HTTP_HOST }}{{ page.url }}.
            </section>
            <section class="tabs-panel is-active" id="contents">
                <div class="tabs" data-tabs id="issue-tabs">
                    <ul class="menu align-right">
                        <li class="tabs-title is-active"><a href="#list" aria-selected="true"><i class="fa fa-list-ul" aria-hidden="true"></i> List</a></li>
                        <li class="tabs-title"><a data-tabs-target="grid" href="#grid"><i class="fa fa-th" aria-hidden="true"></i> Grid</a></li>
                    </ul>
                </div>
                    
                <div class="tabs-content" data-tabs-content="issue-tabs">
                    <section class="tabs-panel is-active" id="list">
                        <div class="row">
                            <div class="small-12 columns">
                                <table class="stack unstriped">
                                    <thead>
                                        <tr>
                                            <th>Page</th>
                                            <th>Category</th>
                                            <th>Title</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% regroup page.issue.articles_and_ads by page as page_list %}

                                        {% for page in page_list %}
                                            {% for article in page.list %}
                                            <tr>
                                                <td>{% if forloop.first%}{{ page.grouper.number }}{% endif %}</td>
                                                <td>{{ article.article_type }}</td>
                                                <td><a href="{% url 'article-detail' publication_slug=page.grouper.issue.publication.slug issue_slug=page.grouper.issue.slug number=page.grouper.number article_slug=article.slug%}">{% if article.title %}{{ article.title }}{% else %}Untitled Article{% endif %}</a></td>
                                            </tr>
                                            {% endfor %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                <section class="tabs-panel" id="grid">
                    <div class="row medium-up-2 large-up-3 container" data-equalizer="cards" data-equalize-by-row="true" data-equalize-on="medium">
                         {% for page in page.issue.pages.all %}
                            <div class="column column-block" data-equalizer-watch="cards">
                                <div class="card">
                                    <a href="{{ page.url }}">
                                        <div class="card-image">
                                            <img src="{% thumbnail page.image.url %}">
                                        </div>
                                        <div class="card-section overlay">
                                            <h3>Page {{ page.number }}</h3>
                                            <div class="card-footer">
                                                {% if page.number_of_articles == 1 %}
                                                {{ page.articles.0.title }}
                                                {% else %}
                                                {{ page.number_of_articles }} Articles
                                                {% endif %}
                                            </div>
                                        </div>
                                    </a>
                                    {% if request.user.is_staff %}
                                    <div class="card-divider">
                                        <a href="/admin/periodicals/page/{{ page.id }}/change/" class="card-footer-item">Edit</a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                    </div>
                </section>
            </section>
        </div>
    </div>
</section>

<div class="row">
    <div class="small-12 columns">
        {% with publication=page.issue.publication issue=page.issue page=page %}
        {% include 'periodicals/includes/pagination.html' %}
        {% endwith %}
    </div>
</div>

{% endblock %}

{% block footer_scripts %}
{% if highlight_words %}
<script>
    var highlight_words = {{ highlight_words | safe }};
</script>
{% endif %}
{% endblock %}
