{% extends "periodicals/base.html" %}
{% load periodicals_tags %}
{% block title %}Explore{% endblock %}
{% block meta_title %}Publications | Explore{% endblock %}
{% block breadcrumbs %}
    <li><a href="/">Home</a></li>
    <li>Explore</li>
{% endblock %}
{% block main %}
    {% get_issues_published_this_month as issues_month %}
    {% if issues_month %}
        <section class="grid-container" id="{{ year }}" data-magellan-target="{{ year }}">
                    <div class="grid-x">
                        <div class="cell">
                            <h3>
                                Published in this month
                            </h3>
                        </div>
                    </div>
        <div class="grid-x grid-padding-x grid-padding-y small-up-2 medium-up-3 large-up-5">
            {% for issue in issues_month %}
                <div class="cell ">
                    <div class="card">
                        <a href="{{ issue.url }}">
                            <div class="card-image">
                                <img src="{{ issue.pages.all.0.image.url }}">
                            </div>
                            <div class="card-section overlay">
                                <h3 class="small-caps">{{ issue }}</h3>
                                <div class="card-footer">{{ issue.articles.count }} Articles, {{ issue.pages.count }}
                                    Pages
                                </div>
                            </div>
                        </a>
                        {% if request.user.is_staff %}
                            <div class="card-divider">
                                <a href="/admin/periodicals/issue/{{ issue.id }}/change/"
                                   class="card-footer-item">Edit</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        </section>
    {% endif %}

    {% get_issues_published_today as issues_day %}
    {% if issues_day %}
        <section class="grid-container" id="{{ year }}" data-magellan-target="{{ year }}">
                    <div class="grid-x">
                        <div class="cell">
                            <h3>
                                Published on this day
                            </h3>
                        </div>
                    </div>
        <div class="grid-x grid-padding-x grid-padding-y small-up-2 medium-up-3 large-up-5">
            {% for issue in issues_day %}
                <div class="cell ">
                    <div class="card">
                        <a href="{{ issue.url }}">
                            <div class="card-image">
                                <img src="{{ issue.pages.all.0.image.url }}">
                            </div>
                            <div class="card-section overlay">
                                <h3 class="small-caps">{{ issue }}</h3>
                                <div class="card-footer">{{ issue.articles.count }} Articles, {{ issue.pages.count }}
                                    Pages
                                </div>
                            </div>
                        </a>
                        {% if request.user.is_staff %}
                            <div class="card-divider">
                                <a href="/admin/periodicals/issue/{{ issue.id }}/change/"
                                   class="card-footer-item">Edit</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        </section>
    {% endif %}
    <div class="grid-container data-equalizer">
        <div class="grid-x grid-padding-x small-up-2 medium-up-3 large-up-5">
            {% for publication in publications %}
                <div class="cell">
                    <div class="card data-equalizer-watch">
                        <a href="{{ publication.url }}">
                            <div class="card-divider">
                                <h2>{{ publication }}</h2>
                            </div>
                            <!-- ** Add Publication image here ** <img src="http://127.0.0.1:8000/static/media/periodicals/119-MOB-1858-03-20-001-SINGLE/Ar0090100.png"> -->
                            <div class="card-section">
                                {% with year_span=publication.get_year_span %}
                                    <h3>{{ year_span.0 }} to {{ year_span.1 }}</h3>
                                {% endwith %}
                                {% with number_of_years=publication.get_number_of_years %}
                                    <h3><strong>{{ number_of_years }}</strong> Year{{ number_of_years|pluralize }}</h3>
                                {% endwith %}
                                <div class="card-footer">{{ publication.issues.count }}
                                    Issues, {{ publication.get_total_number_of_pages }} Pages
                                </div>
                            </div>
                        </a>
                        {% if request.user.is_staff %}
                            <div class="card-divider">
                                <a href="/admin/periodicals/publication/{{ publication.id }}/change/"
                                   class="card-footer-item">Edit</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}