{% extends 'periodicals/base.html' %}
{% load periodicals_tags %}

{% block meta_title %}
    {{ publication }}
{% endblock %}

{% block title %}
    {{ publication }}
{% endblock %}

{% block main %}
<section>
    <div class="row">
        <div class="small-12 columns minus-margin-top">
            <ul class="menu align-right">
                {% get_request_parameters as search_params %}
                {% if search_params %}
                <li><a href="{% url 'search' %}?{{ search_params }}"><i class="fa fa-arrow-left" aria-hidden="true"></i> Back to results</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</section>

{% if publication.description %}
<section>
    <div class="row">
        <div class="small-12 columns">
            <h3>Description</h3> 

            <div class="description-trunk">
                {{ publication.description|truncatewords_html:40 }}

                <a class="read-more" data-target="#description-full">Read more</a>
            </div>

            <div class="description-full" id="description-full">
                {{ publication.description }}
            </div>
        </div>
    </div>
</section>
{% endif %}

{% regroup publication.issues.all by issue_date.year as year_list %}

<section>
    <div class="row">
        <div class="small-12 columns">

            <ul class="tabs" data-deep-link="true" data-update-history="true" data-deep-link-smudge="true" data-deep-link-smudge="500" data-tabs id="deeplinked-tabs">
                <li class="tabs-title is-active"><a href="#panel1d" aria-selected="true">Tab 1</a></li>
                <li class="tabs-title"><a href="#panel2d">Tab 2</a></li>
                <li class="tabs-title"><a href="#panel3d">Tab 3</a></li>
                <li class="tabs-title"><a href="#panel4d">Tab 4</a></li>
            </ul>

            <div class="tabs-content" data-tabs-content="deeplinked-tabs">
                <div class="tabs-panel is-active" id="panel1d">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                </div>
                <div class="tabs-panel" id="panel2d">
                    <p>Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus molestie magna non est bibendum non venenatis nisl tempor. Suspendisse dictum feugiat nisl ut dapibus.</p>
                </div>
                <div class="tabs-panel" id="panel3d">
                    <img class="thumbnail" src="assets/img/generic/rectangle-3.jpg">
                </div>
                <div class="tabs-panel" id="panel4d">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                </div>
            </div>

            <div id="sticky">
                <div data-sticky-container>
                    <div class="sticky" data-sticky-on="small" data-sticky data-margin-top="0" data-anchor="sticky">
                        <nav data-magellan>
                            <ul class="menu subnav" id="publication-year-switcher">
                                <li>
                                    <h2>Years</h2>
                                </li>

                                {% for year, issues_in_year in year_list %}
                                <li>
                                    <a {% if forloop.first %}class='is-active' {% endif %}href="{% url 'publication-issue-ajax' slug=publication.slug year=year %}">
                                        {{ year }} <span>({{ issues_in_year|length }})</span>
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </nav>
                    </div>
                </div>
                <section id="issues-ajax">
                    <div class="row">
                        <div class="small-12 columns">
                            <h3>
                                {{ selected_year }} 
                                <span>({{ selected_issues|length }} issues)</span>
                                {% if not forloop.last %} {% endif %}
                            </h3>
                        </div>
                    </div>
                    <div class="row small-up-2 medium-up-3 large-up-5" data-equalizer="cards" data-equalize-by-row="true" data-equalize-on="medium">
                        {% for issue in selected_issues %}
                        <div class="column" data-equalizer-watch="cards">
                            <div class="card">
                                <a href="{{ issue.url }}">
                                    <div class="card-image">
                                        <img src="{% thumbnail issue.pages.all.0.image.url %}">
                                    </div>
                                    <div class="card-section overlay">
                                        <h3 class="small-caps">{{ publication }}</h3>
                                        <h3 class="small-caps">{{ issue.issue_date }}</h3>
                                        <div class="card-footer">
                                            {{ issue.articles.count }} Articles spanning {{ issue.pages.count }} Pages
                                        </div>
                                    </div>
                                </a>
                                {% if request.user.is_staff %}
                                <div class="card-divider">
                                    <a href="/admin/periodicals/issue/{{ issue.id }}/change/" class="card-footer-item">Edit</a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
            </div>
        </div>
    </div>    
</section>
{% endblock %}